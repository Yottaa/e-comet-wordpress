<project name="yottaa.wordpress" default="dev">

    <property name="module.id" value="wp-yottaa"/>
    <property name="module.title" value="Yottaa Wordpress Integration"/>

    <property file="custom-build.properties"/>

    <property file="build.properties"/>

    <property name="project.dir" value="."/>

    <property name="plugins.file" value="${project.dir}/plugins"/>

    <property name="yottaa.plugin.dir" value="${plugins.file}/${module.id}"/>

    <property name="build.dir" value="${project.dir}/build"/>
    <property name="dist.dir"  value="${project.dir}/dist"/>

    <property name="module.package.file" value="${build.dir}/${module.id}.tar.gz"/>

    <target name="setup" description="Creates all required directories">
        <mkdir dir="${dist.dir}"/>
        <mkdir dir="${build.dir}"/>
    </target>

    <target name="clean">
        <delete failonerror="false">
            <fileset dir="${build.dir}" includes="**/*"/>
            <fileset dir="${dist.dir}" includes="**/*"/>
        </delete>
    </target>

    <target name="package-wordpress-module" description="Packages Wordpress module">
        <echo>Packaging ${module.title} Module file</echo>
        <tar destfile="${module.package.file}" compression="gzip">
            <tarfileset dir="${plugins.file}"/>
        </tar>
    </target>

    <target name="package" depends="clean,setup,package-wordpress-module"/>

    <target name="dist" depends="package">
        <copy todir="${dist.dir}" verbose="true">
            <fileset dir="${build.dir}">
                <include name="*.tar.gz"/>
            </fileset>
        </copy>
    </target>

    <target name="dev">
        <copy todir="${wordpress.location}/wp-content/plugins/${module.id}" verbose="true">
            <fileset dir="${yottaa.plugin.dir}"/>
        </copy>
    </target>

    <target name="unpublish">
        <sshexec host="${scp.wordpress.host}"
                 username="${scp.wordpress.username}"
                 password="${scp.wordpress.password}"
                 trust="true"
                 command="rm -r ${scp.wordpress.basepath}/wp-content/plugins/${module.id}/*"
                 failonerror="false"/>
    </target>

    <target name="publish" depends="unpublish">
        <scp todir="${scp.wordpress.username}@${scp.wordpress.host}:${scp.wordpress.basepath}/wp-content/plugins/${module.id}"
             password="${scp.wordpress.password}"
             trust="true"
             verbose="true"
             failonerror="true">
            <fileset dir="${yottaa.plugin.dir}">
                <include name="**/*"/>
            </fileset>
        </scp>
    </target>

</project>
